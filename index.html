<!doctype html>
<html lang="en-US">
  <head>
	<meta name="generator" content="Hugo 0.78.2" />

    
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-22300706-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-22300706-1');
    </script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0;">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <meta name="description" content="Software programmer interested in SRE, DevOps, Machine Learning and Augmented Reality.">

    <title>inkel</title>
    <meta content="inkel" property="og:title" />
    <link rel="canonical" href="https://inkel.github.io/">

    <meta content="https://inkel.github.io/images/avatar.png" property="og:image" />
    <meta content="inkel" property="og:site_name" />
    <meta content="website" property="og:type" />
    <meta content="https://inkel.github.io/" property="og:url" />
    <meta content="Software programmer interested in SRE, DevOps, Machine Learning and Augmented Reality." property="og:description" /><meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
  </head>
  <body lang="">
    <header>
      <h1>
        <a href="/"><img src="/images/avatar.png" id="avatar" />inkel</a>
      </h1>
      
      <p>Software programmer interested in SRE, DevOps, Machine Learning and Augmented Reality.</p>
      
    </header>



<section id="content">
  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/adventofcode2020-day2/">Advent of Code 2020: Day 2</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 1min.</span>
    <time datetime="2020-12-07 14:47:52 -0300 -03">Published on 2020-07-12</time>
    <nav class="tags">
      
      <a href="/tags/programmming">programmming</a>
      
      <a href="/tags/adventofcode">adventofcode</a>
      
    </nav>
  </section>

  <section class="content">
    <p>Funny how <a href="https://inkel.github.io/posts/adventofcode2020-day1/">day 1 took me 4 days to solve</a> but I was able to <a href="https://github.com/inkel/adventofcode-2020/blob/bc2b6ef16bcf6b7e7425702f1732c67a1da9387e/src/adventofcode_2020/day2.clj">solve day 2</a> in just an hour. I guess the challenges are not strictly in a increasing order of complexity.</p>
<p>I also like that I think my Clojure programming style is getting better as the time passes, which in the end was my sole main objective.</p>
<p>Let‚Äôs see what day 3 lies ahead‚Ä¶</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/adventofcode2020-day1/">Advent of Code 2020: Day 1</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 1min.</span>
    <time datetime="2020-12-06 23:30:00 -0300 -03">Published on 2020-06-12</time>
    <nav class="tags">
      
      <a href="/tags/programming">programming</a>
      
      <a href="/tags/adventofcode">adventofcode</a>
      
    </nav>
  </section>

  <section class="content">
    <p>I did it! I was finally to solve both <a href="https://github.com/inkel/adventofcode-2020/blob/e80cb5b5be71002516c89e95dc86bd857e678eec/src/adventofcode_2020/day1.clj">Day 1 challenges in Clojure</a>! And it only took me four days!</p>
<p>As said in my <a href="https://inkel.github.io/posts/adventofcode-2020/">previous post</a> one of the reasons why I&rsquo;m participating in this years <a href="https://adventofcode.com/2020">Advent of Code</a> is because I want to learn <a href="https://clojure.org/">Clojure</a>, and while at times I felt frustrated because I couldn&rsquo;t find the solution, I&rsquo;m happy that I did. As with everything, in hindsight, the solution is obvious now. Not that while the problems were similar, both solutions are quite different, and I think they showcase my improvement with the language and functional way of thinking.</p>
<p>I&rsquo;m looking forward to Day 2 challenges, and I hope to solve them in less than four days!</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/inkelinks-s01e02/">inkelinks S01E02</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 2min.</span>
    <time datetime="2020-12-04 11:00:08 -0300 -03">Published on 2020-04-12</time>
    <nav class="tags">
      
      <a href="/tags/inkelinks">inkelinks</a>
      
    </nav>
  </section>

  <section class="content">
    <p><a href="https://buttondown.email/inkel/archive/inkelinks-s01e02/">Issue #2 of my newsletter</a> was delivered today. I&rsquo;m really enjoying curating links and sharing them with friends! In case you missed it, here it is:</p>
<p>Yes! Welcome to a new issue of inkelinks. Last time it was the first one and of course I had a typo on the subject üòû but all the links were working, so there‚Äôs that üí™üèΩ</p>
<p>In this issue you‚Äôll find the regular links section plus a new <em>Podcast Episode of the Week</em> section where I‚Äôll share a single link to an episode of the many podcasts that I listen to that I think has value for sharing. I hope you like it!</p>
<p>As always your feedback and suggestions are welcomed!</p>
<h2 id="links">Links</h2>
<ul>
<li><a href="https://owenou.com/upterm/">Upterm - Secure Terminal Sharing</a><br>
I never did too much pair programming, but for sure this looks like an interesting take on making it easier to share a terminal with others.</li>
<li><a href="https://jpmens.net/2016/03/05/a-shell-command-to-create-json-jo/">A shell command to create JSON: jo</a><br>
My good friend Mat√≠as Aguirre (<a href="https://twitter.com/linuxaddict">@linuxaddict on Twitter</a>) shared this with me. I can‚Äôt believe I‚Äôve never heard of it before, this is an awesome utility!</li>
<li><a href="https://metaredux.com/posts/2020/07/07/supercharge-your-bash-history.html">Supercharge Your Bash History</a><br>
Excellent article on how to configure Bash history to show meaningful information and not just every single thing you type in your terminal.</li>
<li><a href="https://www.benkuhn.net/vc/">How to make video calls almost as good as face-to-face</a><br>
In this day and era, video calls are becoming more important at every minute. This article might seem long, but the tl;dr section is concise to give you already lots of pointers. Sadly, for folks like myself in countries where technology is becoming too expensive this will be a ‚Äúlook at how good my setup could be‚Äù article.</li>
<li><a href="https://gauthier.uk/blog/who/">The UNIX <code>who</code> command</a><br>
Nice and short post on how using simple tools like <code>strace</code> and <code>man</code> one can mimic the behavior of a program.</li>
</ul>
<h2 id="podcast-episode-of-the-week">Podcast episode of the week</h2>
<p><a href="https://changelog.com/gotime/145">F√º≈∫≈æƒØ√±g with Katie Hockman, Roberto Clapis, &amp; Filippo Valsorda</a><br>
One of my favourite podcast shows is Go Time, and not so long ago they released an episode on fuzzing, a testing technique where you provide invalid data to your program and monitor for crashes. Whether you‚Äôre a Go developer or not this episode is highly recommended of only because you‚Äôll learn new things!</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/adventofcode-2020/">Advent Of Code 2020</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 1min.</span>
    <time datetime="2020-12-02 10:31:18 -0300 -03">Published on 2020-02-12</time>
    <nav class="tags">
      
      <a href="/tags/programming">programming</a>
      
      <a href="/tags/adventofcode">adventofcode</a>
      
    </nav>
  </section>

  <section class="content">
    <p>For years I&rsquo;ve been a fan of the idea behind <a href="https://adventofcode.com/">Advent of Code</a>:</p>
<blockquote>
<p>‚Ä¶an Advent calendar of small programming puzzles for a variety of skill sets and skill levels that can be solved in any programming language you like.</p>
</blockquote>
<p>For a variety of reasons I&rsquo;ve neglected participating in <a href="https://adventofcode.com/2020/events">past editions</a>, but this year I&rsquo;ve finally decided to give it a try.</p>
<p>The biggest reason behind the decision to join this year was that for the longest time I had the desire to become proficient in any of the many LISP languages out there, particularly in <a href="https://clojure.org/">Clojure</a>, so I saw this as a chance to get more familiar with it, learn something more about it, and having fun while doing so.</p>
<p>There are already 2 puzzles going on, and I haven&rsquo;t even started, but when I do I also plan to publish everything into my <a href="https://github.com/inkel/">GitHub account</a>.</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/inkelinks-s01e01/">inkelinks S01e01</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 2min.</span>
    <time datetime="2020-11-27 15:39:04 -0300 -03">Published on 2020-27-11</time>
    <nav class="tags">
      
      <a href="/tags/links">links</a>
      
    </nav>
  </section>

  <section class="content">
    <p>Welcome to the first episode of <em>inkelinks</em>! I hope the title is clear, but in case it doesn‚Äôt: this is a collection of links that I‚Äôve found useful, fun, or interesting. I‚Äôm planning on releasing a new episode weekly on Fridays at around 14:00 UTC.</p>
<h2 id="links">Links</h2>
<ul>
<li><a href="https://blog.meain.io/2020/bunch-of-git-stuff/">Just a bunch of git stuff</a><br>
I use Git extensively, and I‚Äôm quite aware of many of its internals and obscure commands, yet there‚Äôs always more things to learn.</li>
<li><a href="https://www.benkuhn.net/progessays/">Essays on programming I think about a lot</a><br>
Over time I found many of the linked essays individually, so it‚Äôs nice to have them all in one place. Highly recommended!</li>
<li><a href="https://coding-fonts.css-tricks.com/">Coding Fonts</a><br>
I‚Äôm looking for a new font, this looks like a nice place to start.</li>
<li><a href="https://github.com/TheMozg/awk-raycaster">awk-raycaster: Pseudo-3D shooter written completely in gawk using raycasting technique</a><br>
I‚Äôm in awe. I love AWK, I use it almost daily, but I‚Äôve never thought this was possible.</li>
<li><a href="https://medium.com/@shazow/ssh-how-does-it-even-9e43586e4ffc">Why aren‚Äôt we using SSH for everything?</a><br>
I ask myself the same question. SSH is an awesome protocol, not only for connecting to another computer!</li>
<li><a href="https://www.ibiblio.org/harris/500milemail.html">The case of the 500-mile email</a><br>
This is one of the best stories <strong>ever</strong>.</li>
</ul>
<h2 id="epilogue">Epilogue</h2>
<p>I hope you find this newsletter useful and entertaining. I really enjoyed going through my links collection and digging these gems. Feedback and suggestions always welcomed!</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/newsletter/">I have a newsletter now: inkelinks</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 1min.</span>
    <time datetime="2020-11-26 08:20:45 -0300 -03">Published on 2020-26-11</time>
    <nav class="tags">
      
      <a href="/tags/personal">personal</a>
      
      <a href="/tags/links">links</a>
      
    </nav>
  </section>

  <section class="content">
    <p>One thing I like to do is collect links for reading later, and let&rsquo;s be honest, who hasn&rsquo;t? I also usually share some interesting links with folks at work, where I made myself the fame as the <em>links provider</em>. So that got me thinking: why not creating a newsletter where I can share these links with a broader audience? So thank you to <a href="https://buttondown.email/">Buttondown</a> I now have a newsletter for you: <a href="https://buttondown.email/inkel">inkelinks</a>.</p>
<p>Besides the newsletter I&rsquo;ll be posting the links on this blog too, for those who prefer it that way. But I suggest using the form below so you don&rsquo;t miss any weekly links!</p>
<iframe
scrolling="no"
style="width:100%!important;height:220px;border:1px #ccc solid !important"
src="https://buttondown.email/inkel?as_embed=true"
></iframe><br /><br />
<p>If that doesn&rsquo;t work for you, you can still subscribe from the <a href="https://buttondown.email/inkel">newsletter homepage</a>.</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/inkel-gamer/">Am I a gamer now?</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 2min.</span>
    <time datetime="2020-08-06 10:38:32 -0300 -03">Published on 2020-06-08</time>
    <nav class="tags">
      
      <a href="/tags/gaming">gaming</a>
      
      <a href="/tags/personal">personal</a>
      
    </nav>
  </section>

  <section class="content">
    <p>For years I disliked playing games. Never before in my life I had a gaming console, and the last game I played from start to end was The Secret of Monkey Island. But a couple of years ago I decided to buy a PlayStation 4 and I&rsquo;m extremely happy with that decision. The main reason was of course to start playing myself, but also to raise my kids in a house where gaming is &ldquo;normal&rdquo;.</p>
<p>Why did I wait so long?!</p>
<p>I don&rsquo;t think I&rsquo;m a hardcore gamer, not even close, but since I bought my PS4 I play at least one hour almost every night, as a way of cooling off my mind before going to bed. I find it very relaxing and entertaining. I mostly play solo games, the idea of working online with others doesn&rsquo;t attract me, as I take this time as a <em>me time</em> and I don&rsquo;t want to engage with others. I know that I&rsquo;m missing lots of fun, or so I&rsquo;ve been told, but I&rsquo;m happy with this decision.</p>
<p>Over the course of the upcoming months I&rsquo;ll try and leave some &ldquo;reviews&rdquo; on some of the games I played so far:</p>
<ul>
<li>Horizon: Zero Dawn</li>
<li>God of War</li>
<li>Uncharted Saga</li>
<li>The WItcher 3</li>
<li>Detroit: Becoming Human</li>
<li>Mass Effect: Andromeda</li>
<li>Spider-Man</li>
<li>Rise of the Tomb Raider</li>
<li>The Last of Us</li>
<li>Dragon Age: Inquisition</li>
</ul>
<p>I cannot finish this post without saying this: the very first game I played, <a href="https://www.guerrilla-games.com/play/horizon">Horizon: Zero Dawn</a>, I fell in love with the character, the world, and the story behind it:</p>
<figure class="photo">
  <a href="https://www.guerrilla-games.com/play/horizon">
    <img src="/images/hzd.jpg" alt="Horizon: Zero Dawn" />
  </a>
</figure>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/uses-this/">Uses This</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 7min.</span>
    <time datetime="2020-07-07 11:00:00 -0300 -03">Published on 2020-07-07</time>
    <nav class="tags">
      
      <a href="/tags/personal">personal</a>
      
    </nav>
  </section>

  <section class="content">
    <p>I always liked the interviews at <a href="https://usesthis.com/">Uses This</a>, I find it really interesting knowing other people&rsquo;s setups. And given that I do not foresee them interviewing me anytime soon, I went ahead and wrote my own.</p>
<h2 id="who-are-you-and-what-do-you-do">Who are you, and what do you do?</h2>
<p>I&rsquo;m Leandro L√≥pez, better known on the Internet as <code>inkel</code> (all lowercase). I work as a software developer at <a href="https://theorem.co/">Theorem</a>, mostly doing backend programming but also dabbling in operations when needed. I&rsquo;m interested in programming as a science, machine learning, DevOps (whatever that means), and keeping systems running.</p>
<h2 id="what-hardware-do-you-use">What hardware do you use?</h2>
<p>My main machine is a MacBook Pro 2015 15&quot;, which I love. I&rsquo;ve also have a secondary Dell XPS with Windows 10. Meh.</p>
<p>I, like everyone else, do not like the new butterfly keyboard, and because of that I&rsquo;m using a <a href="https://www.keychron.com/products/keychron-k2-wireless-mechanical-keyboard?variant=31063869554777">Keychron K2</a> as an external, mechanical keyboard; I love this keyboard, it&rsquo;s clickly but not too loud, it can connect to up to 3 devices and seamlessly change from one to the other by pressing a couple keys. The only thing I miss in this keyboard is a Touch ID reader.</p>
<p>For a long while my hands travelled from the K2 to my MBP touchpad, and that was becoming tedious. I love the touchpad, but buying an external one was costly in Argentina, and thus I bought a trackball for the first time in my life, as I also wanted to give them a try. I&rsquo;ve got a <a href="https://www.logitech.com/en-us/product/mx-ergo-wireless-trackball-mouse">Logitech Ergo MX</a> and boy am I happy with it. It didn&rsquo;t take me too long to get used to it, and while it&rsquo;s not the same as the touchpad, it is customizable so I can do many things without leaving my hand off the trackball. Still, I would like for it to have a couple more buttons so I can customize it even more.</p>
<p>As I work in a 100% remote company, calls are something that happen almost daily. For that reason I use mostly <a href="https://www.apple.com/shop/product/MNHF2AM/A/earpods-with-35-mm-headphone-plug?fnode=2c1575ea1bbc6149fd197f885aa3792697d9f7902bff43198ab0e2ad4e045a31f2655938f05ab9b762b2afaf7ae7a9a74fb76b395966a5dc75bdda9d264a13ec932f3314d587e3a53d5a875498bfa64299a2338ed3cbce9f57fe6fe6f7e2794e8da738bd0d992e8f071f34bec2717a306c59d8ccbcb69f0d46b8a2c41ddd4e80">Apple EarPods</a>, they work just great. At my office I&rsquo;ve a pair of <a href="https://www.logitechg.com/en-us/products/gaming-audio/g533-wireless-gaming-headset.html">Logitech G533</a>, which sounds great and are wonderful, but have two main issues to my taste: 1. they are not Bluetooth, you need a USB receptor connected to your computer; 2. after 15 minutes of audio silence (i.e. no audio coming through the speakers), it powers off, which is troublesome if you are doing a presentation and the rest of the audience is muted; I&rsquo;ve already felt the pain of talking and talking and talking and people trying to tell me they couldn&rsquo;t hear me but I couldn&rsquo;t hear them either because the headset was off. Sad emoji. I&rsquo;ve also bought a pair of <a href="https://www.amazon.com/Philips-SHB3075-Wireless-Headphones-Playtime/dp/B07P8R3CTB">Philips SHB3075</a>, they are comfortable and 100% Bluetooth, but for some reason they don&rsquo;t work well with my MBP, so I&rsquo;ve them paired with my iPhone.</p>
<p>When mobile I use an iPhone 8, one that needs a change because my screen shattered. I started using iPhones since the iPhone 5 and never looked back. They are fast, pretty, and just work, as anything from Apple. Are they expensive? Yes. Are they worth it? Hell yes.</p>
<p>I prefer reading physical books than ebooks, nevertheless, I&rsquo;ve an iPad Mini mostly for just that. It&rsquo;s a great device with an excellent size for reading and taking from one place to another, without being a fullsized iPad.</p>
<p>Last but not least, as a developer I spend most of my days sitting, and I&rsquo;m over 40, so a good chair is more than just luxury. Because of that I own a <a href="https://www.erasmo.com.ar/productos/sillas/operativas/onix/">Erasmo Onix</a>, and my life (and back) has been happier ever since. I cannot stress enough how much I recommend to <strong>spend serious money on a good chair</strong>.</p>
<h2 id="and-what-software">And what software?</h2>
<p>On my main computer, macOS as the operative system. It&rsquo;s pretty, it works, it makes me happy. But I know I&rsquo;ve to upgrade to Catalina soon.</p>
<p>Given I&rsquo;m a developer, most of the things I write happens in <a href="https://www.gnu.org/software/emacs/">Emacs</a>. My <a href="https://github.com/inkel/emacs-d"><code>init.el</code></a> is far from perfect and I&rsquo;ve neglected updating it for a long time. Sometimes I use <a href="https://code.visualstudio.com/">Visual Studio Code</a> (VSCode) or <a href="https://visualstudio.microsoft.com/vs/mac/">Visual Studio for Mac</a>, but I always end up coming back to Emacs.</p>
<p>When I&rsquo;m not on Emacs, I spend most of my time in a few <a href="https://www.iterm2.com/">iTerm2</a> tabs. I&rsquo;ve tried other terminals like <a href="https://sw.kovidgoyal.net/kitty/">kitty</a>, and while much faster, it&rsquo;s definitely nowhere near in UX. Besides using tabs I also use <a href="https://github.com/tmux/tmux/wiki">tmux</a> a lot. A LOT. My <a href="https://github.com/inkel/dotfiles/blob/master/tmux.conf"><code>tmux.conf</code></a> is adequately updated to my tastes, although it could use some improvement. Yes, I&rsquo;ve heard about iTerm and tmux integration; no I haven&rsquo;t tried it. I use <a href="https://www.gnu.org/software/bash/">Bash</a>. I&rsquo;m super comfortable with it, so I&rsquo;m not looking to change to another shell in the short term.</p>
<p>Writing Markdown is something I find myself doing every so often, and for that, I use <a href="https://typora.io/">Typora</a>. It&rsquo;s beautiful, elegant, fast, I love it. I <strong>might</strong> switch to <a href="https://bear.app/">Bear</a>, though, as I&rsquo;ve been trying it on my cellphone and it works really well, even without the Pro features; I might upgrade to Pro soon, still haven&rsquo;t decided. This blog is using Typora for the content and <a href="https://gohugo.io/">Hugo</a> as the static site generator.</p>
<p>My other computer runs Windows 10. Windows as an operating system has improved a lot over the years, but it&rsquo;s still, in my opinion, not very developer friendly as an operating system. For writing code, <a href="https://visualstudio.microsoft.com/vs/">Visual Studio</a> is undoubtedly one of the best IDEs there is, although of course mostly tied to developing within the Microsoft platform. I also have VSCode installed: sometimes I just need something that loads fast for quick edits. <a href="https://docs.microsoft.com/en-us/sql/ssms/sql-server-management-studio-ssms?view=sql-server-ver15">SQL Server Management Studio</a> is another great tool though it feels a bit dated.
CLI is where I feel Windows fails the most, and while the new <a href="https://devblogs.microsoft.com/commandline/windows-terminal-1-0/">Windows Terminal</a> looks promising, it still lacks the smooth UX that other terminal emulators like iTerm2 have. The <a href="https://en.wikipedia.org/wiki/Windows_Subsystem_for_Linux">Windows Subsystem for Linux</a> (WSL) is another great addition to CLI on Windows, but again, still a bit clunky.</p>
<p>Languages are varied: I really enjoy writing <a href="https://www.ruby-lang.org/en/">Ruby</a>, love toying with <a href="https://golang.org/">Go</a>, have enough fun to work with <a href="https://dotnet.microsoft.com/">.NET Core</a> and <a href="https://docs.microsoft.com/en-us/dotnet/csharp/">C#</a>. I like to have as much infrastructure as possible described using <a href="https://www.terraform.io/">Terraform</a>. And I really, really love writing scripts using Bash, <a href="https://en.wikipedia.org/wiki/AWK">AWK</a>, <a href="https://www.gnu.org/software/sed/manual/sed.html">sed</a>, <a href="https://curl.haxx.se/">curl</a>, and <a href="https://stedolan.github.io/jq/">jq</a>.</p>
<p>Last but not least is The Cloud. Nothing surprising there: <a href="https://github.com/">GitHub</a> for <a href="https://github.com/inkel">own and Open Source code</a>, and some work related stuff. <a href="https://aws.amazon.com/">Amazon Web Services</a> and <a href="https://azure.com/">Microsoft Azure</a> for hosting stuff.</p>
<h2 id="what-would-be-your-dream-setup">What would be your dream setup?</h2>
<p>I&rsquo;d love to get my hands on one of the newer <a href="https://www.apple.com/macbook-pro-16/">MacBook Pro 16&quot;</a> with at least 32 GB of RAM and an SSD of at elast 1TB. I don&rsquo;t think I&rsquo;m going to try a new mechanical keyboard for the time being, but the <a href="https://www.keychron.com/pages/keychron-k8-wireless-mechanical-keyboard">Keychron K8</a> looks like a good future replacement. Similar with my mouse, I&rsquo;ll continue with my Logitech Ergo MX, but also looking forward to get an <a href="https://www.apple.com/shop/product/MRMF2/magic-trackpad-2-space-gray">Apple Magic Trackpad 2</a>.</p>
<p>I&rsquo;d like to improve my communications setup, probably by getting some <a href="https://www.apple.com/shop/product/MWP22/airpods-pro">AirPods Pro</a>, or a cool Bluetooth headset.</p>
<p>My office needs some love, and due to the Covid-19 pandemic I&rsquo;m not even going, but once back I&rsquo;d like to have one or two external monitors, and a good microphone. I don&rsquo;t have anything in mind yet, though.</p>
<p>As said my phone needs a change, and I&rsquo;m looking forward to buying an iPhone 11. I&rsquo;d also like to leave my computer at the office but still having something portable and comfortable at home where I can do some coding, and that&rsquo;s why I&rsquo;ve an <a href="https://www.apple.com/ipad-pro/">iPad Pro</a> in mind.</p>
<p>I want to have my office devices accessible from home, and thus I&rsquo;m looking at using <a href="https://tailscale.com/">Tailscale</a>. I&rsquo;ve only heard amazing things about them.</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/powershell-grep/">PowerShell grep</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 1min.</span>
    <time datetime="2020-06-17 09:26:22 -0300 -03">Published on 2020-17-06</time>
    <nav class="tags">
      
      <a href="/tags/powershell">powershell</a>
      
      <a href="/tags/cli">cli</a>
      
    </nav>
  </section>

  <section class="content">
    <p>I kept forgetting how to perform the equivalent of <a href="https://man7.org/linux/man-pages/man1/grep.1.html"><code>grep(1)</code></a> in PowerShell. The simple answer is <a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/select-string?view=powershell-7"><code>Select-String</code></a>. It is aliased to <code>sls</code>.</p>
<pre><code>ipconfig | Select-String 192.168
</code></pre><p>I should probably add a <a href="https://stackoverflow.com/a/24914795">permanent alias</a>.</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/work-blocks/">How do I organize my work blocks</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 5min.</span>
    <time datetime="2020-06-10 00:00:00 &#43;0000 UTC">Published on 2020-10-06</time>
    <nav class="tags">
      
      <a href="/tags/theorem">theorem</a>
      
      <a href="/tags/remote%20working">remote working</a>
      
      <a href="/tags/personal">personal</a>
      
    </nav>
  </section>

  <section class="content">
    <p>After publishing my previous <a href="/posts/typical-workday-at-theorem/"><em>Working at Theorem: a typical workday</em></a> article a co-worker asked me the following:</p>
<blockquote>
<p>Can you go into the details of what happens during those &ldquo;work&rdquo; blocks? Do you frequently check slack_email or only check them occasionally? Are you heads down for parts of the day? Do you have dedicated &ldquo;help_review others&rdquo; time or does it happen ad-hoc?</p>
</blockquote>
<p>This is an interesting question, so here are the answers.</p>
<h2 id="checking-email--slack">Checking email / Slack</h2>
<p>I approach these two differently. Email is something I check only when I don‚Äôt have any other task or when I‚Äôm in a break. I don‚Äôt have alerts or notifications when a new email arrives, so it‚Äôs a task that only happens in an active way. I consider email as the best asynchronous communication tool available, thus I treat it that way. I‚Äôve several different filters that labels or archives emails as they arrive so when I check them I don‚Äôt have to lose precious time triaging everything that I‚Äôve received.</p>
<p>Of course working 100% asynchronously is an utopia when working in a team that interacts with an external customer, so synchronous communication is a must; at work we use Slack for this. I‚Äôve enabled notifications although I‚Äôve also muted several channels that only generate noise or are mostly for announcements. I could leave those muted channels, however they are still important and I check them a few times throughout the day, usually after catching up with email.</p>
<p>I try to be conscious of how much affects others when mentioning them on Slack, so I try to keep usage of <code>@here</code> at a minimum, <code>@channel</code> only when it is <strong>urgent or very important</strong>; using <code>@everyone</code> is completely off the table, unless a catastrophe happens.
And when it comes to direct messages I always try to send initially only one message: a greeting plus whatever question or comment I‚Äôd like to communicate; this way the other person can quickly decide to dedicate some time to me or not.</p>
<h2 id="code-reviews">Code reviews</h2>
<p>A big part of my day consists of reviewing pull requests created by other members of the team. I‚Äôm not going to go into the details of how you should behave when doing PR reviews, there are already hundred of posts dedicated to that: this is how I approach this task, YMMV.</p>
<p>First I start by reading the title and description. If those are good and informative then I‚Äôd approach the review in a better mood: good programming is mostly about communication, so I held prose to the same standards as code.</p>
<p>Second I look at each commit individually. Writing clear and well scoped commits makes reviewing easier, as you can better understand the author‚Äôs intentions. PRs with just one or two gigantic commits are a bummer and from time to time I try and teach people to write smaller commits next time.</p>
<p>Last but not least I look at the code in detail. The first things I look for is overall structure: is the code properly indented or doesn‚Äôt violate the rules and standards set for the project? Then I look at the semantics, trying to understand each decision, expecting to see well named variables and methods, easy to follow flow control statements, etc. I can be very nit picky at times, so I have to keep me at bay of not becoming an asshole. And yet there are times when you need to become one; luckily is not something that I need to do often.</p>
<p>PR reviewing is an opportunity for both the author and the reviewer‚Äôs growth as programmers and communicators. Treat it like as a learning experience and not as a chore.</p>
<h2 id="time-management">Time management</h2>
<p>With the current pandemic my working conditions changed quite a bit, even when I was already working remotely. The biggest change was on time management. When I worked from my office, I had some dedicated time for things like checking emails and Slack, for deeply diving into any tasks I was working on, and for reviewing code. Now those dedicated time chunks are gone, so I try to manage my time as follows:</p>
<ul>
<li>Checking emails and Slack is something I do first thing in the morning, before and after lunch, and during any coffee- or cigarette-break;</li>
<li>Working on assigned tasks in 20 minutes chunks. Nowadays is hard to find long stretch hours of work, 20 minutes is a good compromise between <em>I want to do something</em> and <em>gonna check the kids, have a break</em>.</li>
<li>PR reviews: I usually do them after the above mentioned 20 minutes. In the past I also scheduled this way, but after 40 minutes/1 hour instead.</li>
<li>Lunchtime is something I‚Äôve cleared out in my calendar, daily from noon to 1pm, so we have some routine for the kids. This I try to keep on schedule, so it doesn‚Äôt conflicts with my calendar. Of course it doesn‚Äôt always happens but so far it hasn‚Äôt been a problem.</li>
</ul>
<h2 id="endnotes">Endnotes</h2>
<p>As you can see I haven‚Äôt shared any truth revealing insights, though I hope it helps others getting more organized. This schema works for me; it might work for you or don‚Äôt work at all.</p>
<p>Interesting in working with me? Check our <a href="https://theorem.co/careers">careers page</a> and apply to any of our current openings. We are waiting for you ;)</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/dns-alias-to-route53/">Migrating DNSimple ALIAS records to AWS Route53</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 2min.</span>
    <time datetime="2020-04-30 15:29:19 -0300 -03">Published on 2020-30-04</time>
    <nav class="tags">
      
      <a href="/tags/dns">dns</a>
      
      <a href="/tags/route53">route53</a>
      
    </nav>
  </section>

  <section class="content">
    <p>Last week I was tasked with migrating a DNS zone from DNSimple to AWS Route53. Overall it was pretty straightforward except when I had to migrate two <code>ALIAS</code> records. This is a special type of record that‚Äôs not part of the DNS specification, so there was no direct alternative.</p>
<h2 id="subdomain">Subdomain</h2>
<p>Say that you have a subdomain <code>www.example.com</code> that was using an <code>ALIAS</code> record pointing to <code>www.example.net</code>. This is by far the easiest to move, as it implies replacing the <code>TXT</code> record defining the alias for a <code>CNAME</code>.</p>
<h2 id="apex-domain">Apex domain</h2>
<p>This is were it gets complicated. If you had an <code>ALIAS</code> for <code>example.com</code> to <code>example.net</code> you cannot replace it with a <code>CNAME</code>, because apex domains do not support that. The solution is to use an <code>A</code> record, which loses the value of an alias you would need to keep updating the IP address of the destination of it ever changes.</p>
<h2 id="summary">Summary</h2>
<p>As you can see it‚Äôs not that complicated to migrate ALIAS records to AWS Route53, however, they do have some limitations. I‚Äôve went from this</p>
<pre><code>www.example.com. 3600 IN TXT &quot;ALIAS for example.net&quot;
example.com.     3600 IN TXT &quot;ALIAS for example.net&quot;
</code></pre><p>to this</p>
<pre><code>www.example.com.    3600    IN  CNAME   example.net.
example.net.        3600    IN  A       192.168.14.52
</code></pre><p>and achieved the expected results, though we now need to keep an eye on the IP address of the destination.</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/typical-workday-at-theorem/">Working at Theorem: a typical day</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 4min.</span>
    <time datetime="2020-04-28 10:45:00 -0300 -03">Published on 2020-28-04</time>
    <nav class="tags">
      
      <a href="/tags/theorem">theorem</a>
      
      <a href="/tags/remote%20working">remote working</a>
      
      <a href="/tags/personal">personal</a>
      
    </nav>
  </section>

  <section class="content">
    <p>I&rsquo;ve joined <del>Citrusbyte</del><a href="https://theorem.co/">Theorem</a> 9 years ago, and since day 1 it was a fully remote experience. Over the years I&rsquo;ve learned lots about how to organize myself to approach each new workday although never gave much thought to it, until a few days ago, when while interviewing a candidate he asked <em>what does a typical day at Theorem looks like</em>. This post will try to address that question.</p>
<p>First and foremost, a disclaimer: by no means I speak on behalf of Theorem or the rest of my teammates; these are entirely my own experiences and do not reflect the reality of all the great people working at this company.</p>
<p>I live with my girlfriend and our two lovely kids (4 years old and 1 year and a half), so keep that in mind while reading this post.</p>
<p>As you are aware, at the time of writing this post we are living in very strange times, throughout a global pandemic that has most of the world in quarantine with people confined to their places and working remotely. As stated earlier, at Theorem we are 100% remote since the beginning, so the COVID-19 pandemic didn&rsquo;t change much on how we work, although it had some effects.</p>
<h2 id="pre-pandemic-typical-workday">Pre-pandemic typical workday</h2>
<p>I have an office 20 blocks away from home, and my kids went to kindergarten 4 blocks away from the office, so days started at 6:15 am to enjoy breakfast with the family, then we would drive the kids to school, drop them and head to the office. My workdays usually started, then, at 8:00 am.</p>
<figure class="photo"><a href="https://www.flickr.com/photos/inkel/49831040487/in/dateposted/">
    <img src="https://live.staticflickr.com/65535/49831040487_a6ce2c02ea.jpg"/> </a><figcaption>
            <h4>Office</h4>
        </figcaption>
</figure>

<p>The very first thing I usually do any given day is going through my emails and any pending notification from the day before. If something requires my attention immediately I answer right at it, otherwise, I either archive or snooze the message to a later time if required.</p>
<p>Next is checking the status of any ongoing task I have been working previously, and paving the way for what&rsquo;s next. Then, off to work.</p>
<p>Around noon either myself or my girlfriend goes to pick up the kids from school, and takes them home to have lunch, and then back to the office. If I&rsquo;m the one picking them, I do that during my lunch break, and then have a quick bite or snack. Otherwise, I cook something for myself or order some delivery. During this break I might read or watch something.</p>
<p>Then the rest of the day goes on, until 4:00 pm or 5:00 pm, depending on the day, and walk back home. And that concludes a typical workday.</p>
<h2 id="typical-workday-during-the-pandemic">Typical workday during the pandemic</h2>
<p>Things have changed, clearly. We don&rsquo;t wake up anymore at 6:15 am, now it&rsquo;s usually at around 8:00 am. Breakfast is served, and I use this time to catch up on some news and go through my emails and notifications, again snoozing for an hour or so whatever needs my attention; the rest is archived.</p>
<p>I&rsquo;ve set up a standing desk in my bedroom, which is right next to the living room, where the kids spend most of their time playing. The biggest change since the pandemic was that nowadays I don&rsquo;t have long stretches of work time anymore, so I try and split my tasks into smaller time schedules, so I can take a look at my kids, play with them or help them with homework (yes, even my 1.5 years old daughter has Zoom meetings now.)</p>
<figure class="photo">
  <a href="https://www.flickr.com/photos/inkel/49802372406/in/dateposted/" title="Working from home">
    <img src="https://live.staticflickr.com/65535/49802372406_9ea8c8a64d.jpg" alt="Work from home" />
  </a>
  <a href="https://www.flickr.com/photos/inkel/49802676397/in/photostream/" title="Work from home">
    <img src="https://live.staticflickr.com/65535/49802676397_47b9993d65.jpg" alt="Work from home" />
  </a>
  <figcaption>
    <h4>Working from home with kids</h4>
  </figcaption>
</figure>
<p>Lunch and dinner are usually planned the night before, so at around noon either me or my girlfriend starts preparing lunch. The kids love this time as they get to watch something on Netflix. I had to cancel all my meetings during this time, but that doesn&rsquo;t seem to have affected my work. Asynchronous communication works great!</p>
<p>After lunch work continues, and I might be able to get some work-only hours if the kids decide to nap, otherwise, again it&rsquo;s split into smaller chunks of time. Either way, I&rsquo;m still able to drive my commitments to success.</p>
<h2 id="conclusions">Conclusions</h2>
<p>As you can see, not much has changed, other than how many hours in stretch I can work without interruptions. All other work details were already in place given that we are a 100% remote company. The biggest takeaway, for me, is that in order to survive this crazy new world we are living in, you need to work with great people, who understand not all experiences are equal, who trust you will work with professionalism and responsibility, and who you trust back in the same way.</p>
<p>If you like what you read and you would like to form part of this great team, check our <a href="https://theorem.co/careers">careers page</a> and apply to any of our current openings. Who knows? Perhaps your dream job is just waiting for you.</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/cli-sort-tricks/">CLI sort tricks</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 2min.</span>
    <time datetime="2019-05-28 00:00:00 &#43;0000 UTC">Published on 2019-28-05</time>
    <nav class="tags">
      
      <a href="/tags/cli">cli</a>
      
      <a href="/tags/tools">tools</a>
      
    </nav>
  </section>

  <section class="content">
    <p>If you are like me you might have used the <a href="https://linux.die.net/man/1/sort"><code>sort(1)</code></a> CLI utility more than once in your life. Today, I&rsquo;ve found a trick that I&rsquo;ve never used before, and hopefully it will help someone else in the future.</p>
<p>Say that we have the following file to sort:</p>
<pre><code>fpdy 01 08 wcfo
juvi 01 02 ejan
urbx 04 03 ckbw
fkzq 01 08 myaz
fjie 04 09 rhvo
almv 04 02 adhs
cuah 07 04 gbyt
chok 09 06 nqwo
emjd 01 04 ledx
npto 02 10 nqsc
</code></pre><p>Now, supposed that I wanted to sort first by the third column and then for the second one, then one would do <code>sort -k 3 foo.txt</code>. Easy. But what if instead the source file looked like this and I wanted the same results?</p>
<pre><code>fpdy 0108 wcfo
juvi 0102 ejan
urbx 0403 ckbw
fkzq 0108 myaz
fjie 0409 rhvo
almv 0402 adhs
cuah 0704 gbyt
chok 0906 nqwo
emjd 0104 ledx
npto 0210 nqsc
</code></pre><p>Well, tricky, right? Not really: the <code>-k</code> accepts the format <code>F[.C]</code>, where <code>F</code> is the field number (<code>2</code> in our case) and <code>C</code> is the character position within the field (<code>4</code> in our case) so if we run the following we will achieve what we are looking for:</p>
<pre><code>$ sort -k 2.4 foo.txt
almv 0402 adhs
juvi 0102 ejan
urbx 0403 ckbw
cuah 0704 gbyt
emjd 0104 ledx
chok 0906 nqwo
fkzq 0108 myaz
fpdy 0108 wcfo
fjie 0409 rhvo
npto 0210 nqsc
</code></pre><p>Why <code>4</code> and not <code>3</code>, I don&rsquo;t know, but I think it&rsquo;s taking the separator into account. I need to investigate more. But so far I haven&rsquo;t the need to do something as fine-grained as this, so I can still sleep well at night.</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/testing-terraform-providers/">Testing Terraform Providers</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 3min.</span>
    <time datetime="2018-12-06 15:50:17 -0300 -03">Published on 2018-06-12</time>
    <nav class="tags">
      
      <a href="/tags/terraform">terraform</a>
      
    </nav>
  </section>

  <section class="content">
    <p>If there&rsquo;s one piece of technology I&rsquo;ve come to love and depend upon these last years it definitely is <a href="https://www.terraform.io/">Terraform</a>. Sadly, the only provider that seems to be complete is the <a href="https://www.terraform.io/docs/providers/aws/index.html">AWS provider</a>, but others seems to be missing some useful resources or data sources. As an example, these past days at <a href="https://www.citrusbyte.com/">work</a> I had to work with the <a href="https://www.terraform.io/docs/providers/azurerm/index.html">Azure provider</a> and found that I was really missing the ability to query <a href="https://azure.microsoft.com/en-us/">Azure</a> for <a href="https://azure.microsoft.com/en-us/services/virtual-machines/">Virtual Machine</a> IDs, but there wasn&rsquo;t a data source for this, and I didn&rsquo;t want to <a href="https://www.terraform.io/docs/import/index.html">import</a> the virtual machines we&rsquo;ve already created (insert <em>long story</em> reasons here).</p>
<p>But then I remember that Terraform and its providers are written in <a href="https://golang.org/">Go</a>, so I took it to add the resource myself.</p>
<p>This post isn&rsquo;t about how to write providers, the folks at Hashicorp already wrote a guide to <a href="https://www.terraform.io/docs/extend/writing-custom-providers.html">write custom providers</a> which is pretty useful. But I&rsquo;ve found that there was something missing, or that I didn&rsquo;t fully understood, and that was <em>how can I test my changes are working?</em>.</p>
<p>Most if not all providers have unit and acceptance tests that allow to test that the changes we introduced work as expected, which are great for once you want to send a pull request, but I am the type of programmer that likes to try things in the <em>Real World‚Ñ¢</em> before going into the TDD workflow, so I fired up my editor and start hacking on adding a new data source that would allow me to query a virtual machine ID by name. After a few tries, I&rsquo;ve got something that looked about right, but then the question came: how do I test it? If I run <code>terraform init</code> it uses the published provider, which obviously doesn&rsquo;t have the changes I made. I&rsquo;ve found in the documentation some references as to where can you place <a href="https://www.terraform.io/docs/configuration/providers.html#third-party-plugins">third-party providers</a> on your machine for testing, but that didn&rsquo;t really work as it was missing, IMO, some information. Luckily, I&rsquo;ve found some pointers in another document that explains how <a href="https://www.terraform.io/docs/extend/how-terraform-works.html#discovery">Terraform works</a>, but that was still missing some information. After a while, I&rsquo;ve found the solution, and here it is:</p>
<ul>
<li>Git clone <a href="https://github.com/terraform-providers/terraform-provider-azurerm">Azure Terraform provider source code</a>.</li>
<li>Make the changes.</li>
<li>Run <code>go build</code>. This will generate a <code>terraform-provider-azurerm</code> executable in your current directory.</li>
<li>Move the executable to the discovery folder: <code>mv terraform-provider-azurerm ~/.terraform.d/plugins/darwin_amd64/</code></li>
<li>Go to a folder with some Terraform configuration that uses the Azure provider.</li>
<li>Remove the cached version: <code>rm -rv .terraform/plugins/</code> (this will remove all plugins, but don&rsquo;t worry)</li>
<li>Run <code>terraform init</code></li>
<li>Profit!</li>
</ul>
<p>Now I can test my changes with a live Terraform configuration.</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/proxy-protocol-support-in-curl/">Proxy Protocol Support in Curl</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 1min.</span>
    <time datetime="2018-03-21 08:49:02 -0300 -03">Published on 2018-21-03</time>
    <nav class="tags">
      
      <a href="/tags/proxy%20protocol">proxy protocol</a>
      
    </nav>
  </section>

  <section class="content">
    <p>I&rsquo;ve came across the following tweet the other day, and I couldn&rsquo;t be more excited:</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr"><a href="https://t.co/P3BbFqx1ro">https://t.co/P3BbFqx1ro</a> CURLOPT_HAPROXYPROTOCOL: support the HAProxy PROXY protocol<br><br>Add --haproxy-protocol for the command line tool<br><br>Cl...</p>&mdash; curl commits (@curlcommits) <a href="https://twitter.com/curlcommits/status/974961166807109633?ref_src=twsrc%5Etfw">March 17, 2018</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>This is exciting to me as the work I&rsquo;ve been doing in <a href="https://github.com/inkel/viaproxy"><code>viaproxy</code></a> had one caveat: testing it works was a bit convoluted, as I was doing by running an <a href="https://www.haproxy.org/">HAProxy</a> instance with a custom configuration like the following:</p>
<pre><code>global
    debug
    maxconn 4000
    log 127.0.0.1 local0

defaults
    timeout connect 10s
    timeout client  1m
    timeout server  1m

listen without-send-proxy
    mode tcp
    log global
    option tcplog
    bind *:17654
    server app1 127.0.0.1:7655

listen with-send-proxy
    mode tcp
    log global
    option tcplog
    bind *:27654
    bind ipv6@:27654
    server app1 127.0.0.1:7654 send-proxy
</code></pre><p>Luckily commit <a href="https://github.com/curl/curl/commit/6baeb6df35d24740c55239f24b5fc4ce86f375a5"><code>6baeb6df</code></a> adds a new <code>--haproxy-protocol</code> that, as documented, will do the following:</p>
<blockquote>
<p>Send a HAProxy PROXY protocol header at the beginning of the connection. This is used by some load balancers and reverse proxies to indicate the client&rsquo;s true IP address and port.</p>
<p>This option is primarily useful when sending test requests to a service that expects this header.</p>
</blockquote>
<p>Reading the commit changes is very enlightening, too, as it is a great example of nice and simple C code. I&rsquo;m looking forward to the release!</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/responsive-font-size/">Using responsive font sizes</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 1min.</span>
    <time datetime="2017-12-06 11:15:22 -0300 -03">Published on 2017-06-12</time>
    <nav class="tags">
      
      <a href="/tags/css">css</a>
      
      <a href="/tags/frontend">frontend</a>
      
    </nav>
  </section>

  <section class="content">
    <p>Today <a href="https://chadoh.com/">Chad Ostrowski</a>, a fellow engineer at <a href="https://citrusbyte.com/">Citrusbyte</a>, shared an article he wrote: <a href="https://medium.com/@chadoh/css-pro-tips-responsive-font-sizes-and-when-to-use-which-units-d005486985ec">CSS pro tips: responsive font-sizes and when to use which units</a>. After reading it, I couldn&rsquo;t help myself and adapted some of the tips there to this site. It&rsquo;s now much easier to maintain, I think, as I&rsquo;ve removed all previous media queries, but I had to add one:</p>
<div class="highlight"><pre class="chroma"><code class="language-css" data-lang="css"><span class="p">@</span><span class="k">media</span> <span class="nt">only</span> <span class="nt">screen</span> <span class="nt">and</span> <span class="o">(</span><span class="nt">min-device-width</span><span class="o">:</span> <span class="nt">1200px</span><span class="o">)</span> <span class="p">{</span>
  <span class="nt">html</span> <span class="p">{</span> <span class="k">font-size</span><span class="p">:</span> <span class="nb">calc</span><span class="p">(</span><span class="mi">1</span><span class="kt">em</span> <span class="o">+</span> <span class="mf">0.5</span><span class="kt">vw</span><span class="p">);</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div><p>Without this the text on my machine looks <strong>too big</strong>. I need to work on this, I think.</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/pem-to-authorized-keys/">From PEM to OpenSSH for usage in ~/.ssh/authorized_keys</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 1min.</span>
    <time datetime="2017-11-17 15:51:51 -0300 -03">Published on 2017-17-11</time>
    <nav class="tags">
      
      <a href="/tags/ssh">ssh</a>
      
    </nav>
  </section>

  <section class="content">
    <p>Say you have a private key in <a href="https://en.wikipedia.org/wiki/Privacy-enhanced_Electronic_Mail">PEM format</a>, and you want to use that key for SSH into another server, by adding an entry to your <code>~/.ssh/authorized_keys</code> file with the public key of such PEM file. The following command will parse your PEM file and output the required RSA format used in <code>authorized_keys</code>:</p>
<pre><code>ssh-keygen -y -f path/to/file.pem
</code></pre><p>This will output a <code>ssh-rsa AAAA‚Ä¶</code> string that is safe to append to your <code>~/.ssh/authorized_keys</code>. The <a href="https://linux.die.net/man/1/ssh-keygen"><code>ssh-keygen</code></a> uses the <code>-f</code> flag to specify the input file name, and the <code>-y</code> flag to read a private file and output the OpenSSH public key to standard output.</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/reverse-curl/">lruc: a reverse cURL</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 2min.</span>
    <time datetime="2017-10-27 10:24:08 -0300 -03">Published on 2017-27-10</time>
    <nav class="tags">
      
      <a href="/tags/go">go</a>
      
      <a href="/tags/tools">tools</a>
      
    </nav>
  </section>

  <section class="content">
    <p>Today <a href="https://interpreterbook.com/">Thorsten Ball</a> asked a simple question on Twitter:</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Does something like a reverse-curl exist? A tool that allows me to listen on a socket and return one HTTP response?</p>&mdash; Thorsten Ball (@thorstenball) <a href="https://twitter.com/thorstenball/status/923890186479656960?ref_src=twsrc%5Etfw">October 27, 2017</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>After a brief exchange of tweets, I said:</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Or we could write one in Go üò∫</p>&mdash; Lean (inkel) (@inkel) <a href="https://twitter.com/inkel/status/923896402056499200?ref_src=twsrc%5Etfw">October 27, 2017</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>Twenty minutes later <a href="https://github.com/inkel/lruc"><code>lruc</code></a> was born.</p>
<blockquote class="twitter-tweet"><p lang="en" dir="ltr">Oh wow! :)</p>&mdash; Thorsten Ball (@thorstenball) <a href="https://twitter.com/thorstenball/status/923901953821872128?ref_src=twsrc%5Etfw">October 27, 2017</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

<p>It&rsquo;s still very fresh and missing many features, but basically it is a web server that allows you to configure it to always respond with a custom response without too much hassle. The usage is very simple:</p>
<pre><code>Usage of lruc:
  -addr string
        Address to listen for requests (default &quot;:8080&quot;)
  -body -
        Response body. Use - to read from a stdin (default &quot;Hello, World!&quot;)
  -code int
        HTTP response code (default 200)
  -content-type string
        Content-Type (default &quot;text/plain&quot;)
</code></pre><p>Say that you want to create a server that always respond with a <code>404 Not Found</code> and a body of <code>No se pudo encontrar lo que buscaba</code> (Spanish for <em>Couldn&rsquo;t find what you were looking for</em> (sort of)) on port 7070, then you could execute the following:</p>
<pre><code>lruc -addr :7070 -code 404 -body &quot;No se pudo encontrar lo que buscaba&quot;
</code></pre><p>Or say that you want to always return an image, then you could do something like:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">&lt; image.png lruc -content-type image/png -body -

<span class="c1"># Or in an useless use of cat</span>
cat image.png <span class="p">|</span> lruc -content-type image/png -body -
</code></pre></div><p>This seems like an interesting tool to keep working on, so watch <a href="https://github.com/inkel/lruc"><code>github.com/inkel/lruc</code></a> for updates.</p>
<p>PS: did I said already that I love Go?</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/ec2-key-fingerprint/">EC2 Key Pairs Fingerprinting</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 1min.</span>
    <time datetime="2017-10-26 10:38:20 -0300 -03">Published on 2017-26-10</time>
    <nav class="tags">
      
      <a href="/tags/aws">aws</a>
      
    </nav>
  </section>

  <section class="content">
    <p>Ever happened to you that you wanted to know which SSH key you need to connect to an AWS EC2 instance? I always found that the fingerprints don&rsquo;t tell me much, espcially because I always forget how to compute the fingerprints. Good that I&rsquo;m back to writing, so I&rsquo;m dumping my memory here:</p>
<ul>
<li>if the key was generated by AWS, then use <code>openssl pkcs8 -in path/to/key.pem -nocrypt -topk8 -outform DER | openssl sha1 -c</code></li>
<li>if the key was generated using <code>ssh-keygen</code> then use <code>openssl rsa -in path/to/private/key -pubout -outform DER | openssl md5 -c</code></li>
</ul>
<p>Why does AWS uses one format and why SSH other? Escapes my current knowledge.</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/on-go-package-names/">On Go package names</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 2min.</span>
    <time datetime="2017-10-14 22:37:24 -0300 -03">Published on 2017-14-10</time>
    <nav class="tags">
      
      <a href="/tags/go">go</a>
      
    </nav>
  </section>

  <section class="content">
    <h3 id="or-why-i-renamed-githubcominkelgo-proxy-protocol-to-githubcominkelviaproxygithubcominkelviaproxy">Or why I renamed <code>github.com/inkel/go-proxy-protocol</code> to <a href="github.com/inkel/viaproxy"><code>github.com/inkel/viaproxy</code></a>.</h3>
<p>In my <a href="/posts/proxy-protocol/">previous article</a> I introduced a repository that hold the code to create <code>net.Conn</code> objects aware of the <a href="http://www.haproxy.com/blog/haproxy/proxy-protocol/">proxy protocol</a>, but I wasn&rsquo;t happy with the name of the repository.</p>
<p>Package names are important in Go, and one aspect that we tend to overlook is that they actually are part of the calling signature when you want to use an export type or function. With the previous code, if we wanted to use the <code>net.Conn</code> wrapper we would have to first import the library:</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">import</span> <span class="s">&#34;github.com/inkel/go-proxy-protocol/conn&#34;</span>
</code></pre></div><p>Once we did that, then to wrap a connection we would have to call:</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="nx">newCn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">conn</span><span class="p">.</span><span class="nf">WithProxyProtocol</span><span class="p">(</span><span class="nx">cn</span><span class="p">)</span>
</code></pre></div><p>Similarly if we wanted to use the <code>net.Listen</code> alternative, we should&rsquo;ve had to import <code>github.com/inkel/go-proxy-protocol/listen</code> and then call <code>cn, err := listen.WithProxyProtocol</code>. This doesn&rsquo;t look right to my eyes, and hopefully not to yours either. And aside aesthetics, two packages for such limited code? Doesn&rsquo;t make much sense.</p>
<p>So I spent the day thinking on a better name that could allow me to better convey the effect we want to achieve and that fits in just one library, and thus, <a href="github.com/inkel/viaproxy"><code>github.com/inkel/viaproxy</code></a> came to be. Let&rsquo;s see how better the code would look like now when wrapping a connection:</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// import the package
</span><span class="c1"></span><span class="kn">import</span> <span class="s">&#34;github.com/inkel/viaproxy&#34;</span>

<span class="c1">// wrap the connection
</span><span class="c1"></span><span class="nx">newCn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">viaproxy</span><span class="p">.</span><span class="nf">Wrap</span><span class="p">(</span><span class="nx">cn</span><span class="p">)</span>
</code></pre></div><p>Similarly if you want to use the <code>net.Listener</code>, the code looks just as well (and I might even add that looks better):</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="c1">// import the package
</span><span class="c1"></span><span class="kn">import</span> <span class="s">&#34;github.com/inkel/viaproxy&#34;</span>

<span class="c1">// create the listener
</span><span class="c1"></span><span class="nx">ln</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">viaproxy</span><span class="p">.</span><span class="nf">Listen</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="s">&#34;:1234&#34;</span><span class="p">)</span>
</code></pre></div><p>It certainly looks <strong>much</strong> better, and I hope you agree.</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/proxy-protocol/">Proxy Protocol: what is it and how to use it with Go</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 6min.</span>
    <time datetime="2017-10-13 14:30:00 -0300 -03">Published on 2017-13-10</time>
    <nav class="tags">
      
      <a href="/tags/go">go</a>
      
      <a href="/tags/proxy%20protocol">proxy protocol</a>
      
    </nav>
  </section>

  <section class="content">
    <p>Today I became aware of the <a href="http://www.haproxy.com/blog/haproxy/proxy-protocol/">proxy protocol</a>.</p>
<blockquote>
<p>The Proxy Protocol was designed to chain proxies / reverse-proxies without losing the client information.</p>
</blockquote>
<p>If you are proxying an HTTP(S) server, chances are that you have used the <code>X-Forwarded-From</code> header to keep the real remote address of the client making the request and not receving the proxy&rsquo;s address instead. But this only works for HTTP(S): if you are proxying any other kind of TCP service, you are doomed.</p>
<p>Take for instance the following example: we will have a simple TCP server that echo backs the client&rsquo;s remote address:</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;io/ioutil&#34;</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;net&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">ln</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nf">Listen</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="s">&#34;:7654&#34;</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">{</span>
		<span class="nx">cn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ln</span><span class="p">.</span><span class="nf">Accept</span><span class="p">()</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;ln.Accept():&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
			<span class="k">continue</span>
		<span class="p">}</span>

		<span class="k">go</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">cn</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">cn</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">defer</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">cn</span><span class="p">.</span><span class="nf">Close</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;cn.Close():&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}()</span>

	<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;handling connection from&#34;</span><span class="p">,</span> <span class="nx">cn</span><span class="p">.</span><span class="nf">RemoteAddr</span><span class="p">())</span>

	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Fprintf</span><span class="p">(</span><span class="nx">cn</span><span class="p">,</span> <span class="s">&#34;Your remote address is %v\n&#34;</span><span class="p">,</span> <span class="nx">cn</span><span class="p">.</span><span class="nf">RemoteAddr</span><span class="p">())</span>

	<span class="nx">data</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ioutil</span><span class="p">.</span><span class="nf">ReadAll</span><span class="p">(</span><span class="nx">cn</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;reading from client:&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;client sent %d bytes: %q&#34;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span> <span class="nx">data</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>I&rsquo;m running <code>go run server.go</code> in a machine whose IP is <code>192.168.1.20</code>, and I&rsquo;ll be sending requests from another machine whose IP is <code>192.168.1.12</code>. One the server machine I&rsquo;m also running an <a href="HAProxy">https://www.haproxy.org/</a> server that acts as a proxy to the Go program above:</p>
<pre><code>global
    debug
    maxconn 4000
    log 127.0.0.1 local0

defaults
    timeout connect 10s
    timeout client  1m
    timeout server  1m

listen wo-send-proxy
    mode tcp
    log global
    option tcplog
    bind *:17654
    server app1 192.168.1.20:7654

listen w-send-proxy
    mode tcp
    log global
    option tcplog
    bind *:27654
    server app1 192.168.1.20:7654 send-proxy
</code></pre><p>This configuration creates 2 proxies: one listening on port <code>17654</code> which just proxies the client connection to the server, and another proxy listening in port <code>276564</code> which does the same but it also enables using the proxy protocol by using the <a href="http://cbonte.github.io/haproxy-dconv/1.7/configuration.html#send-proxy"><code>send-proxy</code></a> keyword.</p>
<p>On the client machine, I&rsquo;m running the following to send requests directly to the Go server, via the regular proxy and via the proxy with proxy protocol enabled:</p>
<pre><code>$ for port in {,1,2}7654; do echo inkel | nc 192.168.1.20 ${port}; done
Your remote address is 192.168.1.12:44966
Your remote address is 192.168.1.20:57680
Your remote address is 192.168.1.20:57681
</code></pre><p>As you can see in the first case the client is informed that its remote address is <code>192.168.1.12</code>, which is correct, but in both the other cases it says <code>192.168.1.20</code>, which is the address of the proxy. Let&rsquo;s check what the server has to say in its output:</p>
<pre><code>$ go run server.go
2017/10/13 11:50:54 handling connection from 192.168.1.12:44966
2017/10/13 11:50:54 client sent 6 bytes: &quot;inkel\n&quot;
2017/10/13 11:50:54 handling connection from 192.168.1.20:57680
2017/10/13 11:50:54 client sent 6 bytes: &quot;inkel\n&quot;
2017/10/13 11:50:54 handling connection from 192.168.1.20:57681
2017/10/13 11:50:54 client sent 56 bytes: &quot;PROXY TCP4 192.168.1.12 192.168.1.20 58472 27654\r\ninkel\n&quot;
</code></pre><p>Here something interesting happens: the first connection, the one made directly to the Go server, properly shows the remote address as <code>192.168.1.12</code> and the contents. The second and third ones incorrectly report the remote address as <code>192.168.1.20</code> but the third one shows something interesting in what was received from the client: instead of just receiving <code>inkel</code> it first received <code>PROXY TCP4 192.168.1.12 192.168.1.20 58472 27654\r\n</code>. This is what proxy protocol does, and if you see clearly, the client&rsquo;s actual IP address is there!</p>
<p>The proxy protocol, when enabled, will send the following initial line to the proxied server:</p>
<pre><code>PROXY &lt;inet protocol&gt; &lt;client IP&gt; &lt;proxy IP&gt; &lt;client port&gt; &lt;proxy port&gt;\r\n
</code></pre><p>The actual <a href="http://www.haproxy.org/download/1.8/doc/proxy-protocol.txt">specification</a> is fairly simple, and now we can see why the only condition for proxy protocol to work is that <strong>both endpoints of the connection MUST be compatible with proxy protocol</strong>.</p>
<p>This explains why the Go server isn&rsquo;t reporting the right remote address, even when proxy protocol is used: the <a href="https://golang.org/pkg/net/"><code>net</code></a> package doesn&rsquo;t (currently) supports proxy protocol. But adding support to it isn&rsquo;t too difficult. Here we have a custom connection type that complies with the <a href="https://golang.org/pkg/net/#Conn"><code>net.Conn</code></a> interface:</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">myConn</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">cn</span>      <span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span>
	<span class="nx">r</span>       <span class="o">*</span><span class="nx">bufio</span><span class="p">.</span><span class="nx">Reader</span>
	<span class="nx">local</span>   <span class="nx">net</span><span class="p">.</span><span class="nx">Addr</span>
	<span class="nx">remote</span>  <span class="nx">net</span><span class="p">.</span><span class="nx">Addr</span>
	<span class="nx">proxied</span> <span class="kt">bool</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewProxyConn</span><span class="p">(</span><span class="nx">cn</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">)</span> <span class="p">(</span><span class="nx">net</span><span class="p">.</span><span class="nx">Conn</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">c</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">myConn</span><span class="p">{</span><span class="nx">cn</span><span class="p">:</span> <span class="nx">cn</span><span class="p">,</span> <span class="nx">r</span><span class="p">:</span> <span class="nx">bufio</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">cn</span><span class="p">)}</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nf">Init</span><span class="p">();</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">c</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">myConn</span><span class="p">)</span> <span class="nf">Close</span><span class="p">()</span> <span class="kt">error</span>                <span class="p">{</span> <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">cn</span><span class="p">.</span><span class="nf">Close</span><span class="p">()</span> <span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">myConn</span><span class="p">)</span> <span class="nf">Write</span><span class="p">(</span><span class="nx">b</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">cn</span><span class="p">.</span><span class="nf">Write</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">myConn</span><span class="p">)</span> <span class="nf">SetDeadline</span><span class="p">(</span><span class="nx">t</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">)</span> <span class="kt">error</span>      <span class="p">{</span> <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">cn</span><span class="p">.</span><span class="nf">SetDeadline</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">myConn</span><span class="p">)</span> <span class="nf">SetReadDeadline</span><span class="p">(</span><span class="nx">t</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">)</span> <span class="kt">error</span>  <span class="p">{</span> <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">cn</span><span class="p">.</span><span class="nf">SetReadDeadline</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">myConn</span><span class="p">)</span> <span class="nf">SetWriteDeadline</span><span class="p">(</span><span class="nx">t</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Time</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">cn</span><span class="p">.</span><span class="nf">SetWriteDeadline</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">myConn</span><span class="p">)</span> <span class="nf">LocalAddr</span><span class="p">()</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Addr</span>  <span class="p">{</span> <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">local</span> <span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">myConn</span><span class="p">)</span> <span class="nf">RemoteAddr</span><span class="p">()</span> <span class="nx">net</span><span class="p">.</span><span class="nx">Addr</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">remote</span> <span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">myConn</span><span class="p">)</span> <span class="nf">Read</span><span class="p">(</span><span class="nx">b</span> <span class="p">[]</span><span class="kt">byte</span><span class="p">)</span> <span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">c</span><span class="p">.</span><span class="nx">r</span><span class="p">.</span><span class="nf">Read</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">myConn</span><span class="p">)</span> <span class="nf">Init</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="nx">buf</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">r</span><span class="p">.</span><span class="nf">Peek</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="o">&amp;&amp;</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="kc">nil</span> <span class="o">&amp;&amp;</span> <span class="nx">bytes</span><span class="p">.</span><span class="nf">Equal</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="s">`PROXY`</span><span class="p">),</span> <span class="nx">buf</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nx">proxied</span> <span class="p">=</span> <span class="kc">true</span>
		<span class="nx">proxyLine</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">r</span><span class="p">.</span><span class="nf">ReadString</span><span class="p">(</span><span class="sc">&#39;\n&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">err</span>
		<span class="p">}</span>
		<span class="nx">fields</span> <span class="o">:=</span> <span class="nx">strings</span><span class="p">.</span><span class="nf">Fields</span><span class="p">(</span><span class="nx">proxyLine</span><span class="p">)</span>
		<span class="nx">c</span><span class="p">.</span><span class="nx">remote</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">addr</span><span class="p">{</span><span class="nx">net</span><span class="p">.</span><span class="nf">JoinHostPort</span><span class="p">(</span><span class="nx">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">fields</span><span class="p">[</span><span class="mi">4</span><span class="p">])}</span>
		<span class="nx">c</span><span class="p">.</span><span class="nx">local</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">addr</span><span class="p">{</span><span class="nx">net</span><span class="p">.</span><span class="nf">JoinHostPort</span><span class="p">(</span><span class="nx">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="nx">fields</span><span class="p">[</span><span class="mi">5</span><span class="p">])}</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">c</span><span class="p">.</span><span class="nx">local</span> <span class="p">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">cn</span><span class="p">.</span><span class="nf">LocalAddr</span><span class="p">()</span>
		<span class="nx">c</span><span class="p">.</span><span class="nx">remote</span> <span class="p">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">cn</span><span class="p">.</span><span class="nf">RemoteAddr</span><span class="p">()</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">c</span> <span class="o">*</span><span class="nx">myConn</span><span class="p">)</span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">c</span><span class="p">.</span><span class="nx">proxied</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;proxied connection %v&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">cn</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%v&#34;</span><span class="p">,</span> <span class="nx">c</span><span class="p">.</span><span class="nx">cn</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">addr</span> <span class="kd">struct</span><span class="p">{</span> <span class="nx">hp</span> <span class="kt">string</span> <span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">a</span> <span class="nx">addr</span><span class="p">)</span> <span class="nf">Network</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span> <span class="k">return</span> <span class="s">&#34;tcp&#34;</span> <span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">a</span> <span class="nx">addr</span><span class="p">)</span> <span class="nf">String</span><span class="p">()</span> <span class="kt">string</span>  <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">hp</span> <span class="p">}</span>
</code></pre></div>
<p>Now in our server we wrap the connection into our new type, and pass it to the <code>handle</code> func:</p>
<div class="highlight"><pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">ln</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">net</span><span class="p">.</span><span class="nf">Listen</span><span class="p">(</span><span class="s">&#34;tcp&#34;</span><span class="p">,</span> <span class="s">&#34;:7654&#34;</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">{</span>
		<span class="nx">cn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">ln</span><span class="p">.</span><span class="nf">Accept</span><span class="p">()</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;ln.Accept():&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
			<span class="k">continue</span>
		<span class="p">}</span>

<span class="hl">		<span class="nx">pcn</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">NewProxyConn</span><span class="p">(</span><span class="nx">cn</span><span class="p">)</span>
</span>
		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="nx">log</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;NewProxyConn():&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
			<span class="k">continue</span>
		<span class="p">}</span>

		<span class="k">go</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">pcn</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>With this, now we see the right output in both the client:</p>
<pre><code>$ for port in {,1,2}7654; do echo inkel | nc 192.168.1.20 ${port}; done
Your remote address is 192.168.1.12:45050
Your remote address is 192.168.1.20:60729
Your remote address is 192.168.1.12:58556
</code></pre><p>&hellip;and in the server:</p>
<pre><code>2017/10/13 13:37:45 accepted connection from 192.168.1.12:45056
2017/10/13 13:37:45 client sent 6 bytes: &quot;inkel\n&quot;
2017/10/13 13:37:45 accepted connection from 192.168.1.20:60738
2017/10/13 13:37:45 client sent 6 bytes: &quot;inkel\n&quot;
2017/10/13 13:37:45 accepted connection from 192.168.1.12:58562
2017/10/13 13:37:45 client sent 6 bytes: &quot;inkel\n&quot;
</code></pre><p>This has been turned into a Go library located at <a href="https://github.com/inkel/go-proxy-protocol"><code>github.com/inkel/go-proxy-protocol</code></a>. Feel free to use it and send your feedback and error reports!</p>

  </section>

  
</article>

  <hr>
  
  
<article class="page">
  <header>
    <h1>
      <a href="/posts/initial-commit/">Initial Commit</a>
    </h1>
  </header>

  <section class="meta">
    <span class="reading-time">Reading time: 1min.</span>
    <time datetime="2017-10-11 15:47:00 -0300 -03">Published on 2017-11-10</time>
    <nav class="tags">
      
      <a href="/tags/personal">personal</a>
      
    </nav>
  </section>

  <section class="content">
    <p>So here I am, once more, trying to have some sort of blog or journal. I&rsquo;ll try to write about interesting pieces of code that I&rsquo;ve written, problems I had to solve, books I&rsquo;ve read (or dropped), et cetera. Don&rsquo;t get your hopes too high, though, I&rsquo;m lazy and tend to forget doing this kind of stuff.</p>

  </section>

  
</article>

  
</section>


    <footer>
      <nav id="social">
        <a href="https://flickr.com/inkel">flickr</a><a href="https://github.com/inkel">github</a><a href="https://goodreads.com/inkel">goodreads</a><a href="https://instagram.com/inkel">instagram</a><a href="https://twitter.com/inkel">twitter</a>
      </nav>
    </footer>
  </body>
</html>

